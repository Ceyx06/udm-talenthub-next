generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  name      String
  email     String   @unique
  password  String
  role      UserRole @default(APPLICANT)
  createdAt DateTime @default(now())
}

model Vacancy {
  id           String        @id @default(cuid())
  title        String
  college      String
  status       String
  requirements String
  description  String
  postedDate   DateTime      @default(now())
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  applications Application[]

  @@index([status])
  @@index([college])
  @@map("vacancies")
}

model VacancyRequest {
  id                    String   @id @default(cuid())
  jobTitle              String
  college               String
  numberOfSlots         Int
  targetStartDate       DateTime
  minimumQualifications String   @db.Text
  justification         String   @db.Text

  status      String    @default("Pending")
  submittedBy String?
  submittedAt DateTime  @default(now())
  reviewedBy  String?
  reviewedAt  DateTime?
  reviewNotes String?   @db.Text

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([status])
  @@index([college])
  @@index([submittedAt])
  @@map("vacancy_requests")
}

model Application {
  id        String  @id @default(cuid())
  vacancyId String
  vacancy   Vacancy @relation(fields: [vacancyId], references: [id], onDelete: Cascade)

  // Required fields
  fullName    String
  email       String
  phone       String
  coverLetter String
  resumeUrl   String

  status      String   @default("PENDING")
  appliedDate DateTime @default(now())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Personal Information
  firstName        String?
  middleName       String?
  lastName         String?
  contactNo        String?
  dob              DateTime?
  gender           String?
  civilStatus      String?
  presentAddress   String?
  permanentAddress String?
  nationality      String?
  idType           String?
  idNumber         String?

  // Position Information
  desiredPosition String?
  department      String?
  employmentType  String?

  // Education
  highestDegree String?
  trainingHours Int?
  licenseName   String?
  licenseNo     String?
  licenseExpiry DateTime?

  // JSON fields
  experiences Json? @default("[]")
  references  Json? @default("[]")

  // Document URLs
  pdsUrl        String?
  transcriptUrl String?
  trainingsUrl  String?
  employmentUrl String?

  // Application tracking
  signature String?
  signedAt  DateTime?
  qrCode    String?
  message   String?
  stage     String?   @default("APPLIED")

  // Stage dates
  endorsedDate    DateTime?
  employeeId      String?
  hiredAt         DateTime?
  interviewDate   DateTime?
  demoDate        DateTime?
  statusUpdatedAt DateTime?

  // Evaluation
  evaluationScore Float?
  evaluationNotes String?
  rejectionReason String?
  
  // File status
  fileStatus String? @default("pending")

  // Relations
  interviews Interview[]
  evaluation Evaluation?

  @@index([vacancyId])
  @@index([email])
  @@index([status])
  @@index([stage])
  @@map("applications")
}

model Faculty {
  id             String    @id @default(cuid())
  name           String
  position       String
  type           String
  contract       String
  recommendation String
  actions        String
  renewals       Renewal[]
}

model Renewal {
  id                 String             @id @default(cuid())
  facultyName        String
  college            String?
  contractNo         String
  position           String
  deanRemarks        String
  createdAt          DateTime           @default(now())
  updatedAt          DateTime           @updatedAt
  contractEndDate    DateTime?
  deanActedAt        DateTime?
  deanUserId         String
  facultyId          String
  statusUpdatedAt    DateTime?
  type               String
  deanRecommendation DeanRecommendation @default(PENDING)
  status             RenewalStatus      @default(PENDING_DEAN)
  faculty            Faculty            @relation(fields: [facultyId], references: [id], onDelete: Cascade)

  @@index([facultyId])
  @@index([status])
  @@map("renewals")
}

model Interview {
  id               String      @id @default(cuid())
  interviewId      String      @unique
  applicationId    String
  interviewDate    DateTime?
  teachingDemoDate DateTime?
  status           String      @default("Pending")
  notes            String?
  location         String?
  interviewers     String?
  createdAt        DateTime    @default(now())
  updatedAt        DateTime    @updatedAt
  application      Application @relation(fields: [applicationId], references: [id], onDelete: Cascade)

  @@index([applicationId])
  @@index([status])
  @@map("interviews")
}

enum UserRole {
  ADMIN
  HR
  DEAN
  APPLICANT
}

enum RenewalStatus {
  PENDING_DEAN
  APPROVED
  REJECTED
}

enum DeanRecommendation {
  PENDING
  RENEW
  NOT_RENEW
}

model Evaluation {
  id            String   @id @default(cuid())
  applicationId String   @unique
  application   Application @relation(fields: [applicationId], references: [id], onDelete: Cascade)
  
  // Scores by category
  educationalScore       Float @default(0)
  experienceScore        Float @default(0)
  professionalDevScore   Float @default(0)
  technologicalScore     Float @default(0)
  
  // Total and ranking
  totalScore            Float @default(0)
  rank                  String? // e.g., "Lecturer I", "Assistant Professor"
  ratePerHour           Float?  // Calculated based on rank
  
  // Detailed scores (stored as JSON)
  detailedScores        Json?
  
  // Evaluation metadata
  evaluatedBy           String
  evaluatedAt           DateTime @default(now())
  remarks               String?
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([applicationId])
  @@map("evaluations")
}