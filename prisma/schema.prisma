generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/**
 * ============== Enums (single definitions) ==============
 */
enum UserRole {
  ADMIN
  HR
  DEAN
  APPLICANT
}

enum DeanRecommendation {
  PENDING
  RENEW
  NOT_RENEW
}

enum RenewalStatus {
  PENDING_DEAN
  APPROVED
  REJECTED
}

/**
 * ============== Core Models ==============
 */
model User {
  id        String   @id @default(cuid())
  name      String
  email     String   @unique
  password  String
  role      UserRole @default(APPLICANT)
  createdAt DateTime @default(now())
}

/**
 * Keep if you still use this simple applicants list somewhere
 */
model Applicants {
  id      String @id
  name    String
  email   String @unique
  job     String
  college String
  phone   String
  files   String
  stage   String
}

/**
 * Optional: keep if you plan to relate faculty to renewals
 */
model Faculty {
  id             String    @id
  name           String
  position       String
  type           String
  contract       String
  recommendation String
  actions        String
  Renewal        Renewal[]
}

/**
 * ============== Renewals (single definition) ==============
 */
model Renewal {
  id                 String             @id @default(cuid())
  facultyId          String
  facultyName        String
  college            String?
  position           String
  type               String
  contractNo         String
  contractEndDate    DateTime?
  deanRecommendation DeanRecommendation @default(PENDING)
  deanRemarks        String
  deanUserId         String
  deanActedAt        DateTime?
  status             RenewalStatus      @default(PENDING_DEAN)
  statusUpdatedAt    DateTime?
  createdAt          DateTime           @default(now())
  updatedAt          DateTime           @updatedAt
  Faculty            Faculty            @relation(fields: [facultyId], references: [id], onDelete: Cascade)

  @@index([facultyId])
  @@index([status])
  @@map("renewals")
}

/**
 * ============== Vacancy & Application (single set) ==============
 */
model Vacancy {
  id           String        @id @default(cuid())
  title        String
  college      String
  status       String // "OPEN" | "CLOSED" | "DRAFT"
  requirements String
  description  String
  postedDate   DateTime      @default(now())
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  applications Application[]

  @@index([status])
  @@index([college])
  @@map("vacancies")
}

model Application {
  id        String  @id @default(cuid())
  vacancyId String
  vacancy   Vacancy @relation(fields: [vacancyId], references: [id], onDelete: Cascade)

  fullName    String
  email       String
  phone       String
  coverLetter String
  resumeUrl   String

  status      String   @default("Pending")
  appliedDate DateTime @default(now())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Optional extras
  firstName        String?
  middleName       String?
  lastName         String?
  contactNo        String?
  dob              DateTime?
  gender           String?
  civilStatus      String?
  presentAddress   String?
  permanentAddress String?
  nationality      String?
  idType           String?
  idNumber         String?
  desiredPosition  String?
  department       String?
  employmentType   String?
  highestDegree    String?
  trainingHours    String?
  licenseName      String?
  licenseNo        String?
  licenseExpiry    DateTime?
  experiences      Json?     @default("[]")
  references       Json?     @default("[]")
  signature        String?
  signedAt         DateTime?
  qrCode           String?
  message          String?
  stage            String?

  @@index([vacancyId])
  @@index([email])
  @@index([status])
  @@map("applications")
}
